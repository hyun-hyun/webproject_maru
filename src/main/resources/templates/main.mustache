{{>layouts/header}}
<div class="container">
    <!--
  {{#nickname}}
  <p>{{nickname}}ë‹˜, ì´ë©”ì¼ {{id}}, ê¶Œí•œ {{role}}ìœ¼ë¡œ ë¡œê·¸ì¸ì¤‘ì…ë‹ˆë‹¤.</p>
  <hr>
  {{/nickname}}
-->
  {{#write}}
  <div>
      <strong>ê¸€ì“°ê¸° ê°€ëŠ¥(í•´ë‹¹ê¶Œí•œ : manager, admin)</strong>
      <a href="/write/article/anime" class="btn btn-outline-success">ê¸€ì“°ê¸°</a>
  </div>
  {{/write}}

  {{#admin}}
  <div>
      <strong>ê´€ë¦¬ìê¶Œí•œ(admin)</strong>
      <a href="/admin/member" class="btn btn-outline-success">íšŒì›ê´€ë¦¬</a>
      ì¤€ë¹„ì¤‘
  </div>
  <hr>
  {{/admin}}
{{#nickname}}
<!--ì¶”ì²œ 5ê°œ-->
<div class="recommended-reviews">
    <div class="article-list" id="recommendations-list">
        <!-- ì¶”ì²œ ê²Œì‹œë¬¼ ë°ì´í„° ì—¬ê¸°ì— -->
    </div>
</div>

<hr>
{{/nickname}}
  <div class="row">
      <!-- ì™¼ìª½: ì ìˆ˜ ë†’ì€ ì‘í’ˆ (TOP 15) -->
      <div class="col-md-6">
          <br>
          <h3>ğŸ˜²1ê°œì›”ê°„ TOP 15 
              <a href="/articles/anime/top" class="btn btn-sm btn-info">3ê°œì›”ê°„ TOP50</a>
          </h3><br>
          <div id="top-articles" class="w-100"></div>
      </div>

      <!-- ì˜¤ë¥¸ìª½: ìµœê·¼ ë“±ë¡ëœ ì‘í’ˆ -->
      <div class="col-md-6">
          <br>
          <h3>ğŸ˜€ìµœê·¼ ë“±ë¡ ì‘í’ˆ
              <a href="/articles/anime" class="btn btn-sm btn-info">ì „ì²´ ì‘í’ˆë³´ê¸°</a>
          </h3><br>
          <div id="recent-articles" class="w-100"></div>
      </div>
  </div>
</div>

{{>layouts/footer}}

<script>
//ì¶”ì²œ5ê°œ(ë¡œê·¸ì¸ì‹œ)
{{#member_id}}
const memberId = {{.}};  // ë¡œê·¸ì¸ëœ ì‚¬ìš©ì ID (Mustacheë¡œ ì „ë‹¬)
fetch(`/api/mypage/recommended-articlesOnly/${memberId}`)
        .then(response => response.json())
        .then(articles => {
            const recommendationsContainer = document.getElementById("recommendations-list");

            // 5ê°œì˜ ì¶”ì²œ ê²Œì‹œë¬¼ì„ HTMLë¡œ ë³€í™˜í•˜ì—¬ ì¶”ê°€
            articles.forEach(article => {
                const articleDiv = document.createElement("div");
                articleDiv.className = "article-item";

                let tagsHtml = '';
                if (article.usedTags && Array.isArray(article.usedTags)) {
                    article.usedTags.forEach(tag => {
                        tagsHtml += `<span class="btn btn-outline-info m-1 tag">${tag}</span>`;
                    });
                }

                articleDiv.innerHTML = `
                    <a href="/articles/anime/${article.id}" class="a">
                        <div class="score"></div> <!-- ë³„ì„ í‘œì‹œí•  ë¶€ë¶„ -->
                        <img src="/images/pic/anime/${article.main_pic}" alt="ë©”ì¸ì‚¬ì§„" class="main-pic">
                        <div class="article-info">
                            <b class="title">[${article.genre}] ${article.title}</b>
                            <div class="tags">${tagsHtml}</div>
                        </div>
                    </a>
                `;
                recommendationsContainer.appendChild(articleDiv);

            });
        })
        .catch(error => {
            console.error('ì¶”ì²œ ê²Œì‹œë¬¼ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ë° ë¬¸ì œê°€ ìƒê²¼ìŠµë‹ˆë‹¤:', error);
        });
{{/member_id}}

// ë°ì´í„° ë¡œë”© í•¨ìˆ˜: TOP 15 ì‘í’ˆ ê°€ì ¸ì˜¤ê¸°
function loadTopArticles() {
  fetch('/api/main/top')
      .then(response => response.json())
      .then(articles => {
          const container = document.getElementById('top-articles');
          articles.forEach(article => {
              const articleDiv = document.createElement("div");
              articleDiv.className = "article";
              let tagsHtml = '';
              if (article.usedTags && Array.isArray(article.usedTags)) {
                  article.usedTags.forEach(tag => {
                      tagsHtml += `<span class="btn btn-outline-info m-1 tag">${tag}</span>`;
                  });
              }
              articleDiv.innerHTML = `
                  <div class="article-content" data-article-id="${article.id}">
                      <img src="/images/pic/anime/${article.main_pic}" width="150" alt="ì‘í’ˆí‘œì§€" class="article-image">
                      <div class="article-info">
                          <b>[${article.genre}] ${article.title}</b>
                          <div class="tags">${tagsHtml}</div>
                          <span class="story">${article.story}</span>
                      </div>
                  </div>
              `;
              container.appendChild(articleDiv);

              // í´ë¦­ ì´ë²¤íŠ¸ ì¶”ê°€
              articleDiv.querySelector('.article-content').addEventListener('click', () => {
                  window.location.href = `/articles/anime/${article.id}`;
              });
          });
      })
      .catch(error => console.error('Error loading top articles:', error));
}

// ë°ì´í„° ë¡œë”© í•¨ìˆ˜: ìµœê·¼ ë“±ë¡ëœ ì‘í’ˆ ê°€ì ¸ì˜¤ê¸°
function loadRecentArticles() {
  fetch('/api/main/recent')
      .then(response => response.json())
      .then(articles => {
          const container = document.getElementById('recent-articles');
          articles.forEach(article => {
              const articleDiv = document.createElement("div");
              articleDiv.className = "article";
              let tagsHtml = '';
              if (article.usedTags && Array.isArray(article.usedTags)) {
                  article.usedTags.forEach(tag => {
                      tagsHtml += `<span class="btn btn-outline-info m-1 tag">${tag}</span>`;
                  });
              }
              articleDiv.innerHTML = `
                  <div class="article-content" data-article-id="${article.id}">
                      <img src="/images/pic/anime/${article.main_pic}" width="150" alt="ì‘í’ˆí‘œì§€" class="article-image">
                      <div class="article-info">
                          <b>[${article.genre}] ${article.title}</b>
                          <div class="tags">${tagsHtml}</div>
                          <span class="story">${article.story}</span>
                      </div>
                  </div>
              `;
              container.appendChild(articleDiv);

              // í´ë¦­ ì´ë²¤íŠ¸ ì¶”ê°€
              articleDiv.querySelector('.article-content').addEventListener('click', () => {
                  window.location.href = `/articles/anime/${article.id}`;
              });
          });
      })
      .catch(error => console.error('Error loading recent articles:', error));
}

// í˜ì´ì§€ ë¡œë“œ ì‹œ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
document.addEventListener('DOMContentLoaded', function() {
  loadTopArticles(); // TOP 15 ë¡œë“œ
  loadRecentArticles(); // ìµœê·¼ ì‘í’ˆ ë¡œë“œ
});
</script>
<style>
    //ì¶”ì²œê²Œì‹œê¸€
    .recommended-reviews {
        margin-top: 30px;
    }

    .article-list {
        display: flex;
        flex-wrap: wrap;
        justify-content: flex-start;  /* ì™¼ìª½ ì •ë ¬ */
    }

    .article-item {
        width: calc(20% - 10px); /* 5ê°œ ë‹¨ìœ„ë¡œ ê°€ë¡œ ë°°ì¹˜ */
        margin-bottom: 20px;
        padding: 15px;
        background-color: #fff;
        border-radius: 10px;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        transition: all 0.3s ease;
        cursor: pointer;
    }

    .article-item:hover {
        transform: translateY(-5px);
        box-shadow: 0 6px 15px rgba(0, 0, 0, 0.2);
    }

    .main-pic {
        width: 100%;
        object-fit: cover;
    }

    .score-reason {
        background-color: white;
        color: black;
        padding: 5px;
        text-overflow: ellipsis;
        display: -webkit-box;
        -webkit-box-orient: vertical;
        -webkit-line-clamp: 2;
    }

    .score {
        text-align: center;
    }

    /* ëª¨ë°”ì¼ í™”ë©´ì—ì„œ í•œ ì¤„ì— 3ê°œì”© ë³´ì´ë„ë¡ ì„¤ì • */
    @media (max-width: 768px) {
        .article-item {
            width: calc(33.33% - 10px); /* 3ê°œê°€ í•œ ì¤„ì— í‘œì‹œë˜ë„ë¡ ì„¤ì • */
        }
    }
</style>