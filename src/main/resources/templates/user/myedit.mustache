{{>layouts/header}}
<div class="container">
<br>
<h2><div style="text-align:center">ë‚´ ì •ë³´ ìˆ˜ì •</div></h2>
<h4>ğŸ‘‰ ê°œì¸ì •ë³´ ìˆ˜ì •</h4>
    <form class="px-4 py-3" id="editForm" action="/editProc" method="post">
        <input type="hidden" name="id" value="{{member_id}}">
        <input type="hidden" id="gender" value="{{gender}}">
        <div class="mb-3">
            <label class="form-label"><b>ë‹‰ë„¤ì„</b></label>
            <div class="input-group">
                <input type="text" class="form-control" name="nickname" id="nickname" placeholder="ë‹‰ë„¤ì„">
                <button type="button" class="btn btn-outline-secondary" id="nicknameCheck">ì¤‘ë³µí™•ì¸</button>
            </div>
        </div>
        <div id="nicknameMessage" class="alert" style="display:none;"></div>

        <div class="mb-3">
            <label class="form-label"><b>ì„±ë³„</b></label>
            <div class="gender-container">
              <input type="radio" name="gender" id="male" value="ë‚¨" required>
              <label class="gender-label" for="male">ë‚¨ì„±</label>
              
              <input type="radio" name="gender" id="female" value="ì—¬" required>
              <label class="gender-label" for="female">ì—¬ì„±</label>
              
              <input type="radio" name="gender" id="private" value="ë¬´" required>
              <label class="gender-label" for="private">ë¹„ê³µê°œ</label>
            </div>
          </div>

           <button type="submit" id="submitEdit" class="btn btn-primary">ìˆ˜ì •ì™„ë£Œ</button>
    </form>
    {{#error}}
    <script>
        alert("{{.}}");  <!-- ì„œë²„ì—ì„œ ë°›ì€ ì—ëŸ¬ ë©”ì‹œì§€ë¥¼ alertë¡œ í‘œì‹œ -->
    </script>
    {{/error}}
<hr>
<h4>ğŸ‘‰ ë¹„ë°€ë²ˆí˜¸ ìˆ˜ì •</h4>
    <form class="px-4 py-3" id="pswdEditForm" action="/pswdEditProc" method="post">
        <input type="hidden" name="id" value="{{member_id}}">
        <div class="mb-3">
            <label class="form-label"><b>ê¸°ì¡´ ë¹„ë°€ë²ˆí˜¸</b></label>
            <input type="password" class="form-control" name="pswd" id="password" placeholder="ë¹„ë°€ë²ˆí˜¸" required>

            <label class="form-label"><b>ìƒˆ ë¹„ë°€ë²ˆí˜¸</b></label>
            <input type="password" class="form-control" name="n_pswd" id="new_password" placeholder="ë¹„ë°€ë²ˆí˜¸" required>
            <div class="alert alert-danger" id="passwordLengthError" style="display:none;">ë¹„ë°€ë²ˆí˜¸ëŠ” ìµœì†Œ 5ì ì´ìƒ ì…ë ¥í•´ì£¼ì„¸ìš”.</div>
            <div class="alert alert-danger" id="passwordCharacterError" style="display:none;">ì˜ì–´ì™€ ìˆ«ìë¥¼ ì„ì–´ì„œ ë¹„ë°€ë²ˆí˜¸ë¥¼ ë§Œë“¤ì–´ì£¼ì„¸ìš”.</div>
            
            <input type="password" class="form-control" id="confirmPassword" placeholder="ë¹„ë°€ë²ˆí˜¸ í™•ì¸" required>
            <div class="alert alert-danger" id="confirmPasswordError" style="display:none;">ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.</div>
            <div class="alert alert-success" id="confirmPasswordSuccess" style="display:none;">ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•©ë‹ˆë‹¤.</div>
        </div>
        <button type="submit" id="submitPswdEdit" class="btn btn-primary">ìˆ˜ì •ì™„ë£Œ</button>

    </form>
    {{#p_error}}
    <script type="text/javascript">
        alert("{{.}}");  <!-- ì„œë²„ì—ì„œ ë°›ì€ ì—ëŸ¬ ë©”ì‹œì§€ë¥¼ alertë¡œ í‘œì‹œ -->
    </script>
    {{/p_error}}
<hr>
ğŸ‘‰ íšŒì› íƒˆí‡´ğŸ˜¢(í˜„ì¬ ë¯¸ì§€ì›)
</div>
{{>layouts/footer}}

<script>
    // ë‹‰ë„¤ì„ ì¤‘ë³µ í™•ì¸
    const nicknameInput = document.getElementById('nickname');
    const nicknameCheckButton = document.getElementById('nicknameCheck');

    nicknameInput.addEventListener('input', function() {
        const firstChar = this.value.charAt(0);
        const isValid = this.value && /^[a-zA-Z0-9ê°€-í£]/.test(firstChar); // ì²« ê¸€ìê°€ ë¹ˆì¹¸, íŠ¹ìˆ˜ë¬¸ì, í•œêµ­ì–´ê°€ ì•„ë‹Œì§€ ì²´í¬
        nicknameCheckButton.disabled = !isValid; // ì¡°ê±´ì— ë”°ë¼ ë¹„í™œì„±í™”
    });

    nicknameCheckButton.disabled = true; // ì´ˆê¸°ì—ëŠ” ë¹„í™œì„±í™”
    let nicknameCheckCount = 0; // ë‹‰ë„¤ì„ ì¤‘ë³µí™•ì¸ ìš”ì²­ ì¹´ìš´íŠ¸

    document.getElementById('nicknameCheck').addEventListener('click', function() {
        if (nicknameCheckCount >= 20) {
            alert("ë‹‰ë„¤ì„ ì¤‘ë³µ í™•ì¸ ìš”ì²­ì€ 20ë²ˆì„ ì´ˆê³¼í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
            return; // ìš”ì²­í•˜ì§€ ì•ŠìŒ
        }

        const nickname = document.getElementById('nickname').value;
        // AJAX ìš”ì²­ìœ¼ë¡œ ë‹‰ë„¤ì„ ì¤‘ë³µ í™•ì¸
        fetch(`/api/checkNickname?nickname=${nickname}`)
            .then(response => response.json())
            .then(data => {
                const messageDiv = document.getElementById('nicknameMessage');
                if (data.exists) {
                    messageDiv.className = 'alert alert-danger';
                    messageDiv.textContent = 'ì´ë¯¸ ë“±ë¡ëœ ë‹‰ë„¤ì„ì…ë‹ˆë‹¤. ë‹¤ë¥¸ ë‹‰ë„¤ì„ìœ¼ë¡œ ì‹œë„í•˜ì„¸ìš”.';
                } else {
                    messageDiv.className = 'alert alert-success';
                    messageDiv.textContent = 'ì‚¬ìš© ê°€ëŠ¥í•œ ë‹‰ë„¤ì„ì…ë‹ˆë‹¤.';
                }
                messageDiv.style.display = 'block';
                nicknameCheckCount++; // ìš”ì²­ ì¹´ìš´íŠ¸ ì¦ê°€
            })
            .catch(error => console.error('Error:', error));
    });
    //ì„±ë³„ ì„ íƒë˜ì–´ìˆê²Œ
    window.onload = function() {
        // hidden í•„ë“œì—ì„œ gender ê°’ì„ ê°€ì ¸ì˜µë‹ˆë‹¤.
        var gender = document.getElementById('gender').value;

        // gender ê°’ì— ë§ëŠ” ë¼ë””ì˜¤ ë²„íŠ¼ì„ ì„ íƒí•©ë‹ˆë‹¤.
        if (gender === 'ë‚¨') {
            document.getElementById('male').checked = true;
        } else if (gender === 'ì—¬') {
            document.getElementById('female').checked = true;
        } else if (gender === 'ë¬´') {
            document.getElementById('private').checked = true;
        }
    };

    //ì²«ë²ˆì§¸ ìˆ˜ì •ì™„ë£Œ í´ë¦­ì‹œ
    document.getElementById('submitEdit').addEventListener('click', function(event) {
        const nickname = document.getElementById('nickname').value;
        const nicknameMessage = document.getElementById('nicknameMessage');
    
        if(nickname.trim() !== "" && !nicknameMessage.classList.contains('alert-success')) {
            event.preventDefault(); // ìš”ì²­ì„ ë§‰ìŒ
            alert("ë‹‰ë„¤ì„ ì¤‘ë³µí™•ì¸ì„ í•´ì£¼ì„¸ìš”."); // ì‚¬ìš©ìì—ê²Œ ì•ˆë‚´
        }
    });

    // ë¹„ë°€ë²ˆí˜¸ ìœ íš¨ì„± ê²€ì‚¬
    document.getElementById('new_password').addEventListener('input', function() {
        const password = this.value;
        const lengthError = document.getElementById('passwordLengthError');
        const characterError = document.getElementById('passwordCharacterError');

        lengthError.style.display = password.length < 5 ? 'block' : 'none';
        characterError.style.display = !(/\d/.test(password) && /[a-zA-Z]/.test(password)) ? 'block' : 'none';
    });

    // ë¹„ë°€ë²ˆí˜¸ í™•ì¸ ê²€ì‚¬
    document.getElementById('confirmPassword').addEventListener('input', function() {
        const confirmPassword = this.value;
        const password = document.getElementById('new_password').value;
        const confirmPasswordError = document.getElementById('confirmPasswordError');
        const confirmPasswordSuccess = document.getElementById('confirmPasswordSuccess');

        if (confirmPassword !== password) {
            confirmPasswordError.style.display = 'block';
            confirmPasswordSuccess.style.display = 'none';
        } else {
            confirmPasswordError.style.display = 'none';
            confirmPasswordSuccess.style.display = 'block';
        }
    });

    //ë‘ë²ˆì§¸ ìˆ˜ì •ì™„ë£Œ í´ë¦­ì‹œ
    document.getElementById('submitPswdEdit').addEventListener('click', function(event) {
      const password = document.getElementById('new_password').value;
      const confirmPassword = document.getElementById('confirmPassword').value;
      const passwordLengthError = document.getElementById('passwordLengthError');
      const passwordCharacterError = document.getElementById('passwordCharacterError');
      const confirmPasswordError = document.getElementById('confirmPasswordError');
      const confirmPasswordSuccess = document.getElementById('confirmPasswordSuccess');
  
      // ë¹„ë°€ë²ˆí˜¸ ê¸¸ì´ì™€ ë¬¸ì ìœ íš¨ì„± ê²€ì‚¬
      const isPasswordValid = password.length >= 5 && /\d/.test(password) && /[a-zA-Z]/.test(password);
      const isConfirmPasswordValid = password === confirmPassword;

      // í•„ìˆ˜ í•­ëª© ê²€ì‚¬
      if (
          !isPasswordValid ||
          !isConfirmPasswordValid
      ) {
          event.preventDefault(); // ìš”ì²­ì„ ë§‰ìŒ
          alert("ë¹„ë°€ë²ˆí˜¸ë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”"); // ì‚¬ìš©ìì—ê²Œ ì•ˆë‚´
          if (!isPasswordValid) {
              passwordLengthError.style.display = 'block';
              passwordCharacterError.style.display = 'block';
          }
          if (!isConfirmPasswordValid) {
              confirmPasswordError.style.display = 'block';
              confirmPasswordSuccess.style.display = 'none';
          }
      }
    });
</script>

//ì„±ë³„
<style>
    .gender-container {
      display: flex; /* Flexbox ì‚¬ìš© */
      justify-content: flex-start; /* ì¢Œì¸¡ ì •ë ¬ */
      gap: 2; /* ê°„ê²© ì‘ê²Œ */
      margin-bottom: 15px; /* ì•„ë˜ìª½ ì—¬ë°± */
    }
  
    .gender-label {
      border: 1px solid #ccc; /* í…Œë‘ë¦¬ */
      border-radius: 5px; /* ë‘¥ê·¼ ëª¨ì„œë¦¬ */
      width: 100px; /* ë„ˆë¹„ ì„¤ì • */
      text-align: center; /* í…ìŠ¤íŠ¸ ê°€ìš´ë° ì •ë ¬ */
      padding: 5px; /* ì•ˆìª½ ì—¬ë°± */
      cursor: pointer; /* ì»¤ì„œ ë³€ê²½ */
    }
  
    input[type="radio"] {
      display: none; /* ë¼ë””ì˜¤ ë²„íŠ¼ ìˆ¨ê¸°ê¸° */
    }
  
    input[type="radio"]:checked + .gender-label {
      background-color: #007bff; /* ì„ íƒëœ ê²½ìš° ë°°ê²½ ìƒ‰ìƒ ë³€ê²½ */
      color: white; /* ì„ íƒëœ ê²½ìš° ê¸€ì ìƒ‰ìƒ ë³€ê²½ */
    }
  </style>