{{>layouts/header}}
<div class="container">
    <br>
    <h2>3개월간 TOP50</h2>
    <br>
    <hr>
    <table class="table" id="article-table">
        <tbody id="article-list"></tbody>
    </table>
</div>
{{>layouts/footer}}

<script>
    // 페이지 로딩 시 3개월간 top50 게시글을 불러오는 함수
    function loadTopArticles() {
        fetch('/api/articles/top')
            .then(response => response.json())
            .then(articles => {
                const articleListContainer = document.getElementById('article-list');

                // API에서 반환된 각 게시글 데이터를 렌더링
                articles.forEach(article => {
                    const articleRow = document.createElement('tr');
                    articleRow.className = 'article-row';
                    articleRow.setAttribute('data-article-id', article.id);

                    // 태그들 렌더링
                    let tagsHtml = '';
                    if (article.usedTags && Array.isArray(article.usedTags)) {
                        article.usedTags.forEach(tag => {
                            tagsHtml += `<span class="btn btn-outline-info m-1 tag">${tag}</span>`;
                        });
                    }

                    // 게시글 내용 구성
                    articleRow.innerHTML = `
                    <div class="article-content">
                      <img src="/images/pic/anime/${article.main_pic}" width="150" alt="작품표지" class="article-image">
                      <div class="article-info">
                          평점 ${article.avg_score}점 / ${article.c_score} 리뷰<br>
                          <b class="title">[${article.genre}] ${article.title}</b>
                          <div class="tags">${tagsHtml}</div>
                          <div class="meta-info">
                              ${article.broad_date} | ${article.author} | ${article.ani_company}
                          </div>
                          <span class="story">${article.story}</span>
                      </div>
                  </div>
                    `;

                    // 추가된 row를 화면에 추가
                    articleListContainer.appendChild(articleRow);

                    // 클릭 시 상세 페이지로 이동
                    articleRow.addEventListener('click', function() {
                        window.location.href = `/articles/anime/${article.id}`;
                    });
                });
            })
            .catch(error => {
                console.error('Error fetching articles:', error);
            });
    }

    // 페이지 로드 시 3개월 간 TOP50 게시글을 불러옴
    document.addEventListener('DOMContentLoaded', function() {
        loadTopArticles();
    });
</script>

<style>
    .tag {
        display: inline-block;
        padding: 0.5em 1em;
        font-size: 0.7em;
    }
</style>
