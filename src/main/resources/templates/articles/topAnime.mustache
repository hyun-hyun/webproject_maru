{{>layouts/header}}
<div class="container">
    <br>
    <h2>ğŸ‘3ê°œì›”ê°„ TOP50</h2>
    <br>
    <hr>
    <div class="article-list" id="article-list">
        <!-- ë‚´ìš© -->
    </div>
</div>
{{>layouts/footer}}

<script>
    // í˜ì´ì§€ ë¡œë”© ì‹œ 3ê°œì›”ê°„ top50 ê²Œì‹œê¸€ì„ ë¶ˆëŸ¬ì˜¤ëŠ” í•¨ìˆ˜
    async function loadTopArticles() {
        try {
            const response = await fetch('/api/articles/top');
            const articles = await response.json();

            const articleListContainer = document.getElementById('article-list');

            // APIì—ì„œ ë°˜í™˜ëœ ê° ê²Œì‹œê¸€ ë°ì´í„°ë¥¼ ë Œë”ë§
            articles.forEach(article => {
                const articleRow = document.createElement('tr');
                articleRow.className = 'article-row';
                articleRow.setAttribute('data-article-id', article.id);

                // íƒœê·¸ë“¤ ë Œë”ë§
                let tagsHtml = '';
                if (article.usedTags && Array.isArray(article.usedTags)) {
                    article.usedTags.forEach(tag => {
                        tagsHtml += `<span class="btn btn-outline-info m-1 tag">${tag}</span>`;
                    });
                }

                // ê²Œì‹œê¸€ ë‚´ìš© êµ¬ì„±
                articleRow.innerHTML = `
                    <div class="article-content">
                        <img src="/images/pic/anime/${article.main_pic}" width="150" alt="ì‘í’ˆí‘œì§€" class="article-image">
                        <div class="article-info">
                            í‰ì  ${article.avgscore}ì  / ${article.cscore} ë¦¬ë·°<br>
                            <b class="title">[${article.genre}] ${article.title}</b>
                            <div class="tags">${tagsHtml}</div>
                            <div class="meta-info">
                                ${article.broaddate} | ${article.author} | ${article.ani_company}
                            </div>
                            <span class="story">${article.story}</span>
                        </div>
                    </div>
                `;

                // ì¶”ê°€ëœ rowë¥¼ í™”ë©´ì— ì¶”ê°€
                articleListContainer.appendChild(articleRow);

                // í´ë¦­ ì‹œ ìƒì„¸ í˜ì´ì§€ë¡œ ì´ë™
                articleRow.addEventListener('click', function () {
                    sessionStorage.setItem('scrollPosition', window.scrollY); // ìŠ¤í¬ë¡¤ ìœ„ì¹˜ ì €ì¥
                    window.location.href = `/articles/anime/${article.id}`;
                });
            });
        } catch (error) {
            console.error('Error fetching articles:', error);
        }
    }

    // ìŠ¤í¬ë¡¤ ìœ„ì¹˜ ë³µêµ¬ í•¨ìˆ˜
    function restoreScrollPosition() {
        let scrollPosition = sessionStorage.getItem('scrollPosition');
        scrollPosition = parseInt(scrollPosition, 10);

        if (!isNaN(scrollPosition)) {
            window.scrollTo(0, scrollPosition); // ìŠ¤í¬ë¡¤ ìœ„ì¹˜ ë³µêµ¬
            sessionStorage.removeItem('scrollPosition'); // ë³µêµ¬ í›„ ìŠ¤í¬ë¡¤ ìœ„ì¹˜ ì‚­ì œ
        }
    }

    // í˜ì´ì§€ ë¡œë“œ í›„ ìŠ¤í¬ë¡¤ ìœ„ì¹˜ ë³µêµ¬
    document.addEventListener('DOMContentLoaded', async function () {
        await loadTopArticles(); // ê²Œì‹œê¸€ ë¡œë“œ
        restoreScrollPosition(); // í˜ì´ì§€ ë¡œë”© í›„ ìŠ¤í¬ë¡¤ ìœ„ì¹˜ ë³µêµ¬
    });

    // ë’¤ë¡œê°€ê¸° ì‹œ ìŠ¤í¬ë¡¤ ë³µêµ¬ (popstate ì´ë²¤íŠ¸)
    window.addEventListener('popstate', function () {
        restoreScrollPosition(); // ë’¤ë¡œê°€ê¸° ì‹œ ìŠ¤í¬ë¡¤ ìœ„ì¹˜ ë³µêµ¬
    });
</script>

<style>
    .article-list {
        margin-top: 30px;
        display: flex;
        flex-direction: column;
        gap: 20px; /* ê° ì¶”ì²œ í•­ëª© ê°„ ê°„ê²© */
    }

    .tag {
        display: inline-block;
        padding: 0.5em 1em;
        font-size: 0.7em;
    }

    /* ë°˜ì‘í˜• ë””ìì¸ */
    @media (max-width: 768px) {
        .article-content {
            flex-direction: column; /* ëª¨ë°”ì¼ì—ì„œëŠ” ì„¸ë¡œë¡œ ìŒ“ì´ê²Œ */
            align-items: flex-start;
        }

        .article-image {
            margin-right: 0;
            margin-bottom: 15px;
        }
    }
</style>
